<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>謎解きセンサーゲーム</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="game-container">
        <header>
            <h1>謎解きセンサーゲーム</h1>
            <div id="stage-info">
                <span id="current-stage">ステージ 0</span>
            </div>
        </header>

        <main id="game-screen">
            <!-- ステージ0: チュートリアル -->
            <div id="stage-0" class="stage active">
                <div class="puzzle-content">
                    <h2>チュートリアル</h2>
                    <p>このゲームはスマートフォンのセンサーを使った謎解きです。</p>
                    <p>デバイスを動かしたり、向きを変えたりして謎を解いてください。</p>
                    <div class="sensor-display">
                        <div class="sensor-item">
                            <span>コンパス:</span>
                            <span id="compass-value">0°</span>
                        </div>
                        <div class="sensor-item">
                            <span>傾きX:</span>
                            <span id="tilt-x">0°</span>
                        </div>
                        <div class="sensor-item">
                            <span>傾きY:</span>
                            <span id="tilt-y">0°</span>
                        </div>
                    </div>
                    <p>センサーの値が変化するのを確認したら、次のステージに進みましょう。</p>
                    <button id="tutorial-next" class="next-button">次のステージへ</button>
                </div>
            </div>

            <!-- ステージ1: コンパス45度チャレンジ -->
            <div id="stage-1" class="stage">
                <div class="puzzle-content">
                    <h2>ステージ 1</h2>
                    <p>スマートフォンを回転させて、コンパスの値を<strong>45°</strong>にしてください。</p>
                    <p>45°を3秒間維持すればクリアです！</p>
                    
                    <div class="compass-display">
                        <div class="compass-circle">
                            <div class="compass-needle" id="compass-needle"></div>
                            <div class="compass-directions">
                                <span class="direction north">N</span>
                                <span class="direction east">E</span>
                                <span class="direction south">S</span>
                                <span class="direction west">W</span>
                            </div>
                        </div>
                        <div class="compass-value-large" id="compass-display">0°</div>
                    </div>
                    
                    <div class="target-info">
                        <p>目標: 45°</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="hold-progress"></div>
                        </div>
                        <p id="hold-timer">0.0秒維持中</p>
                    </div>
                </div>
            </div>

            <!-- ステージ2: 東北を向く -->
            <div id="stage-2" class="stage">
                <div class="puzzle-content">
                    <h2>ステージ 2</h2>
                    <p>スマートフォンを<strong>東北</strong>の方角に向けてください。</p>
                    <p>東北（北東）の方角は45°です。</p>
                    
                    <div class="direction-display">
                        <div class="current-direction" id="current-direction">北</div>
                        <div class="direction-compass">
                            <div class="direction-needle" id="direction-needle"></div>
                            <div class="direction-labels">
                                <span class="dir-label" style="top: 10px;">N<br>北</span>
                                <span class="dir-label" style="top: 30px; right: 30px;">NE<br>東北</span>
                                <span class="dir-label" style="right: 10px;">E<br>東</span>
                                <span class="dir-label" style="bottom: 30px; right: 30px;">SE<br>南東</span>
                                <span class="dir-label" style="bottom: 10px;">S<br>南</span>
                                <span class="dir-label" style="bottom: 30px; left: 30px;">SW<br>南西</span>
                                <span class="dir-label" style="left: 10px;">W<br>西</span>
                                <span class="dir-label" style="top: 30px; left: 30px;">NW<br>北西</span>
                            </div>
                        </div>
                        <div class="compass-value-large" id="direction-compass-display">0°</div>
                    </div>
                    
                    <div class="target-direction">
                        <p>目標方角: 東北（NE） - 45°</p>
                        <div class="accuracy-indicator" id="accuracy-indicator">
                            <span id="accuracy-text">方角を調整してください</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ステージ3: シェイクチャレンジ -->
            <div id="stage-3" class="stage">
                <div class="puzzle-content">
                    <h2>ステージ 3</h2>
                    <p>スマートフォンを<strong>振って</strong>ください。</p>
                    <p>5回のシェイクを検出すればクリアです！</p>
                    
                    <div class="shake-display">
                        <div class="shake-icon">📱</div>
                        <div class="shake-count-display" id="shake-count">0 / 5</div>
                        
                        <div class="shake-instruction">
                            <p>デバイスを上下に振ってください</p>
                        </div>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="shake-progress"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ステージ4: 水平維持チャレンジ -->
            <div id="stage-4" class="stage">
                <div class="puzzle-content">
                    <h2>ステージ 4</h2>
                    <p>スマートフォンを<strong>水平</strong>に保ってください。</p>
                    <p>3秒間水平を維持すればクリアです！</p>
                    
                    <div class="level-display">
                        <div class="level-circle">
                            <div class="level-bubble" id="level-bubble"></div>
                            <div class="level-crosshair"></div>
                        </div>
                        
                        <div class="level-info">
                            <div id="tilt-magnitude">傾き: 0°</div>
                            <div class="accuracy-indicator" id="level-indicator">
                                <span id="level-timer">0.0秒維持中</span>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill" id="level-progress"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ステージ5: 複合チャレンジ -->
            <div id="stage-5" class="stage">
                <div class="puzzle-content">
                    <h2>ステージ 5</h2>
                    <p><strong>最終チャレンジ</strong></p>
                    <p>以下の3つの条件を同時に満たしてください：</p>
                    
                    <div class="compound-challenge">
                        <div class="challenge-conditions">
                            <div class="condition-indicator" id="north-indicator">
                                北向き: ✗ (0°差)
                            </div>
                            <div class="condition-indicator" id="level-indicator-5">
                                水平: ✗ (0°傾き)
                            </div>
                            <div class="condition-indicator" id="shake-indicator">
                                シェイク: 0/3
                            </div>
                        </div>
                        
                        <div class="final-status" id="final-status">
                            条件を満たしてください
                        </div>
                        
                        <div class="mini-compass">
                            <div class="mini-compass-circle">
                                <div class="mini-compass-needle" id="mini-compass-needle"></div>
                                <div class="mini-compass-directions">
                                    <span class="mini-direction north">N</span>
                                    <span class="mini-direction east">E</span>
                                    <span class="mini-direction south">S</span>
                                    <span class="mini-direction west">W</span>
                                </div>
                            </div>
                            <div class="mini-compass-value" id="mini-compass-display">0°</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ステージ6: バイブレーションモールス信号 -->
            <div id="stage-6" class="stage">
                <div class="puzzle-content">
                    <h2>ステージ 6</h2>
                    <p><strong>モールス信号</strong>を解読してください。</p>
                    <p>バイブレーションで再生されるモールス信号を聞いて、正しい英単語を入力してください。</p>
                    
                    <div class="morse-display">
                        <div class="morse-instruction">
                            <div class="morse-legend">
                                <div class="morse-legend-item">
                                    <span class="morse-dot">●</span>
                                    <span>短い振動 = ドット (.)</span>
                                </div>
                                <div class="morse-legend-item">
                                    <span class="morse-dash">━</span>
                                    <span>長い振動 = ダッシュ (-)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="morse-controls">
                            <button id="play-morse-btn" class="next-button morse-button">
                                📳 モールス信号を再生
                            </button>
                            
                            <div class="morse-visual-container">
                                <div class="morse-visual" id="morse-visual"></div>
                                <div class="morse-visual-label">視覚的フィードバック</div>
                            </div>
                            
                            <div class="morse-status" id="morse-status">
                                新しいモールス信号を再生する準備ができました
                            </div>
                        </div>
                        
                        <div class="morse-input-section">
                            <label for="morse-input" class="morse-label">解読した英単語を入力:</label>
                            <input type="text" id="morse-input" class="morse-input" placeholder="例: SOS" maxlength="8" autocomplete="off">
                            
                            <div class="morse-hint" id="morse-hint"></div>
                            
                            <button id="submit-morse-btn" class="next-button morse-submit">
                                答えを送信
                            </button>
                        </div>
                        
                        <div class="morse-help">
                            <details>
                                <summary>モールス信号表を見る</summary>
                                <div class="morse-table">
                                    <div class="morse-table-row">
                                        <span>A: ●━</span>
                                        <span>B: ━●●●</span>
                                        <span>C: ━●━●</span>
                                        <span>D: ━●●</span>
                                        <span>E: ●</span>
                                    </div>
                                    <div class="morse-table-row">
                                        <span>F: ●●━●</span>
                                        <span>G: ━━●</span>
                                        <span>H: ●●●●</span>
                                        <span>I: ●●</span>
                                        <span>J: ●━━━</span>
                                    </div>
                                    <div class="morse-table-row">
                                        <span>K: ━●━</span>
                                        <span>L: ●━●●</span>
                                        <span>M: ━━</span>
                                        <span>N: ━●</span>
                                        <span>O: ━━━</span>
                                    </div>
                                    <div class="morse-table-row">
                                        <span>P: ●━━●</span>
                                        <span>Q: ━━●━</span>
                                        <span>R: ●━●</span>
                                        <span>S: ●●●</span>
                                        <span>T: ━</span>
                                    </div>
                                    <div class="morse-table-row">
                                        <span>U: ●●━</span>
                                        <span>V: ●●●━</span>
                                        <span>W: ●━━</span>
                                        <span>X: ━●●━</span>
                                        <span>Y: ━●━━</span>
                                        <span>Z: ━━●●</span>
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 成功メッセージ -->
        <div id="success-modal" class="modal">
            <div class="modal-content">
                <h3>ステージクリア！</h3>
                <p id="success-message">おめでとうございます！</p>
                <button id="next-stage-btn" class="next-button">次のステージへ</button>
            </div>
        </div>

        <!-- センサー許可要求モーダル -->
        <div id="permission-modal" class="modal active">
            <div class="modal-content">
                <h3>センサーへのアクセス許可が必要です</h3>
                <p>このゲームはスマートフォンのセンサーを使用します。</p>
                <p>センサーへのアクセスを許可してください。</p>
                <button id="request-permission" class="next-button">許可する</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html> 